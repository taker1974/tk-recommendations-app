# Техническое задание 1 этапа

## Условие задачи

Привет, мы банк «Стар». Мы хотим внедрить рекомендательную систему для улучшения маркетинга и помощи сотрудникам в предложении персонализированных услуг клиентам.

Ваша задача — создать сервис, который будет рекомендовать нашим клиентам новые банковские продукты.

Сначала нужно сделать MVP (минимальный жизнеспособный продукт) на основе этого задания. В дальнейшем возможны доработки на основе обратной связи.

Входные данные сервиса
Ваш сервис будет использовать данные из уже наполненной базы данных. На реальных проектах обычно эта база данных установлена где-то в инфраструктуре компании, но в нашем случае мы будем использовать встраиваемую файловую базу данных H2.

В данной базе данных есть три основные сущности:

Пользователи банка.
Продукты банка.
Операции пользователей по продуктам банка.
Эти сущности не управляются вашим приложением, то есть не нужно делать для них классы Entity и настраивать JPA. Вместо этого мы будем использовать JDBC и
JdbcTemplate
. Подробнее о них можно узнать в материалах к этому уроку.

База данных ниже содержит все необходимые таблицы, а также уже заполнена данными для выдачи рекомендаций:

transaction.mv.db

Данную базу данных можно открыть и посмотреть с помощью DBeaver, для этого при создании соединения необходимо выбрать базу данных H2GIS Embedded и указать путь к файлу базы данных.

Данная база данных — только для чтения, вносить в нее какие-то изменения по ходу работы с сервисом не нужно. Если у вас появится необходимость создать свою сущность для данного сервиса, то нужно будет подключить вторую базу данных.

Продукты для рекомендации пользователям представляют собой название и тип продукта, некоторое текстовое описание продукта и набор правил, при выполнении которого продукт попадает в список рекомендаций пользователя.

Для первой итерации приложения набор продуктов и правил описан ниже.

Название
ID
Набор правил
Текст описания
Invest 500
147f6a0f-3b91-413b-ab99-87f081d60d5a
Пользователь использует как минимум один продукт с типом DEBIT.
Пользователь не использует продукты с типом INVEST.
Сумма пополнений продуктов с типом SAVING больше 1000 ₽.
Откройте свой путь к успеху с индивидуальным инвестиционным счетом (ИИС) от нашего банка! Воспользуйтесь налоговыми льготами и начните инвестировать с умом. Пополните счет до конца года и получите выгоду в виде вычета на взнос в следующем налоговом периоде. Не упустите возможность разнообразить свой портфель, снизить риски и следить за актуальными рыночными тенденциями. Откройте ИИС сегодня и станьте ближе к финансовой независимости!

Top Saving
59efc529-2fff-41af-baff-90ccd7402925
Пользователь использует как минимум один продукт с типом DEBIT.
Сумма пополнений по всем продуктам типа DEBIT больше или равна 50 000 ₽ ИЛИ Сумма пополнений по всем продуктам типа SAVING больше или равна 50 000 ₽.
Сумма пополнений по всем продуктам типа DEBIT больше, чем сумма трат по всем продуктам типа DEBIT.
Откройте свою собственную «Копилку» с нашим банком! «Копилка» — это уникальный банковский инструмент, который поможет вам легко и удобно накапливать деньги на важные цели. Больше никаких забытых чеков и потерянных квитанций — всё под контролем!

Преимущества «Копилки»:

Накопление средств на конкретные цели. Установите лимит и срок накопления, и банк будет автоматически переводить определенную сумму на ваш счет.

Прозрачность и контроль. Отслеживайте свои доходы и расходы, контролируйте процесс накопления и корректируйте стратегию при необходимости.

Безопасность и надежность. Ваши средства находятся под защитой банка, а доступ к ним возможен только через мобильное приложение или интернет-банкинг.

Начните использовать «Копилку» уже сегодня и станьте ближе к своим финансовым целям!

Простой кредит
ab138afb-f3ba-4a93-b74f-0fcee86d447f
Пользователь не использует продукты с типом CREDIT.
Сумма пополнений по всем продуктам типа DEBIT больше, чем сумма трат по всем продуктам типа DEBIT.
Сумма трат по всем продуктам типа DEBIT больше, чем 100 000 ₽.
Откройте мир выгодных кредитов с нами!

Ищете способ быстро и без лишних хлопот получить нужную сумму? Тогда наш выгодный кредит — именно то, что вам нужно! Мы предлагаем низкие процентные ставки, гибкие условия и индивидуальный подход к каждому клиенту.

Почему выбирают нас:

Быстрое рассмотрение заявки. Мы ценим ваше время, поэтому процесс рассмотрения заявки занимает всего несколько часов.

Удобное оформление. Подать заявку на кредит можно онлайн на нашем сайте или в мобильном приложении.

Широкий выбор кредитных продуктов. Мы предлагаем кредиты на различные цели: покупку недвижимости, автомобиля, образование, лечение и многое другое.

Не упустите возможность воспользоваться выгодными условиями кредитования от нашей компании!

Рассмотрим подробнее правила для рекомендаций

Для того чтобы мы могли рекомендовать продукт, описанный в таблице, пользователю, должны быть выполнены все правила, указанные в столбце «набор правил».

Клиент является пользователем какого-то продукта тогда и только тогда, когда в таблице транзакций по этому продукту есть любая транзакция.

Выражение «Сумма пополнений по всем продуктам типа DEBIT» означает, что нужно сложить величину всех транзакций пополнения (DEPOSIT), которые были сделаны конкретным пользователем по продуктам типа DEBIT. Для этого понадобится соединить таблицы транзакций и таблицу продуктов, используя SQL, так как в самой таблице транзакций указания на тип продукта нет, есть только id продукта.

Если в правиле есть «ИЛИ», это буквально означает, что должно выполняться логическое «ИЛИ» между двумя записанными правилами.

Все правила объединяются логическим «И».

Функционально на первом этапе сервис получает id пользователя и по каждой рекомендации из таблицы проверяет, подходит ли этот пользователь под правила этой рекомендации, и если да, то добавляет продукт из таблицы с текстом и именем в ответ REST API.

Для проверки того, что вы написали запросы корректно, в базе данных есть пользователи, для которых выполняются все правила.

cd515076-5d8a-44be-930e-8d4fcb79f42d — пользователь, для которого выполняются все правила для рекомендации 1.

d4a4d619-9a0c-4fc5-b0cb-76c49409546b — пользователь, для которого выполняются все правила для рекомендации 2.

1f9b149c-6577-448a-bc94-16bea229b71a — пользователь, для которого выполняются все правила для рекомендации 3.

Для данных пользователей также могут выполняться правила и для других рекомендаций, поэтому если, например, для пользователя с рекомендацией 1 валидна также рекомендация 2, то в этом нет вашей ошибки.

## Техническое описание функциональности

Сервис должен выставлять наружу один метод REST API со следующими характеристиками(важно соблюдать именно такой интерфейс API, изменения в полях и путях не допускаются):

```Json
Request: GET /recommendation/<user_id>
Response:
200 OK
Content-Type: application/json
{
 "user_id": <user_id>,
 "recommendations": [
  {
            "name": <имя продукта>, 
            "id": <id продукта>, 
            "text": "текстовое описание продукта"
        },
  ...
 ]
}
```

В случае если для данного пользователя нет рекомендаций, нужно возвращать  такой же объект, как и в случае наличия рекомендаций, но массив recommendations должен быть пустым.

Сервис должен представлять собой SpringBoot-приложение, использующее розданную базу данных в качестве источника данных.
Также важно учитывать, что даже в первой итерации решение должно быть достаточно производительным с точки зрения SQL-запросов и вычислений. Для запросов разрешено использовать только JdbcTemplate. Также стоит внимательно отнестись к анализу тех правил, которые есть в таблице рекомендаций. Нужно постараться выделить общие запросы, которые подходят для всех правил, и использовать параметры к ним для того, чтобы получить нужный запрос для правила.
Также при построении сервиса учитывайте, что данное техническое задание содержит только первую итерацию работы над сервисом, а в будущем он будет развиваться.
В данном домашнем задании вам необходимо предоставить код, реализующий функциональность данного технического задания, а также показать динамику команды по работе с задачами, GIT, и ветками.

Домашнее задание можно сдавать, даже если система не обеспечивает пока нужную функциональность, так как задача наставника как тимлида — указать на ошибки и проблемы в текущем коде, а не проверять код на выполнение функциональных требований. Функциональность конечного продукта будет проверяться на этапе сдачи курсовой работы, однако не стоит пытаться сделать всё перед курсовой, так как работы будет много.

Документацию в этом домашнем задании прикладывать необязательно: она будет проверяться на этапе сдачи курсовой работы.

Рекомендации по архитектуре проекта

Так как это ваша первая большая работа, для которой необходимо также и объектно ориентированное проектирование, мы поможем вам в планировании архитектуры проекта.

Из этого технического задания можно выделить следующие объекты:

Сервис рекомендаций — сервис Spring, который содержит один метод, в котором мы получаем id пользователя и возвращаем список рекомендаций для этого пользователя (в зависимости от того, подошел ли какой-то продукт пользователю, список может быть и пустым, и наполненным рекомендациями).
Объект рекомендации — DTO, которое используется для передачи данных в контроллер и пользователю. Простой Java-объект, состоящий из полей id, «имя» и «текст».
Некоторый интерфейс RecommendationRuleSet — интерфейс с одним методом, который получает id пользователя и возвращает объект рекомендации или null. Также можно использовать Optional, это является предпочтительным вариантом.
Несколько реализаций интерфейса RecommendationRuleSet, помеченные как @Component, по количеству наших рекомендаций. В теле метода, который мы реализуем, нужно проверить, подходит ли пользователь под заданный одной из рекомендаций набор правил.
Репозиторий для выполнения запросов в БД.
Контроллер для обработки веб-запросов.
Само атомарное правило вида «Сумма трат по всем продуктам типа DEBIT больше чем 100 000 ₽» также можно представить в виде объекта определенного типа Rule, однако этого можно и не делать. Дополнительную проработку этого интерфейса, если вы захотите его делать, вы сможете сделать самостоятельно.

Также нужно создавать все компоненты и классы нашего приложения так, чтобы их можно было легко протестировать модульными тестами с помощью Mockito и JUnit.

## Правила отправки работы на проверку

Ссылку на публичный репозиторий присылает один член команды. Он получает и передает обратную связь команде. Выберите ответственного человека и сообщите его имя куратору.

Несмотря на то что в эту итерацию сдавать документацию не нужно, она потребуется при сдаче курсовой работы. Поэтому мы прикладываем весь список артефактов, который потребуется в курсовой, уже сейчас, чтобы вы планировали свою работу и нагрузку.

## Список артефактов для курсовой

Проект должен содержать в себе заполненную вики с проектной документацией:

- Краткое содержание проекта;
- Требования в формате user story + Non-Functional Requirements или Functional / Non-Functional Requirements;
- Таблица трейсинга требований. Таблица, в которой конкретное требование привязано к issue на Github;

- Диаграмма компонентов приложения или диаграмма классов;
- Диаграмма поведения (Activity Diagram);

- Документ REST API в формате Swagger;

- Требования по развертыванию проекта в текстовом виде или виде диаграммы размещения;

- Проект в Github project с расписанным треком задач, показывающим командную динамику;
- Полностью выполненный проект, удовлетворяющий требованиям суммарного техзадания (оно будет доступно при открытии материала курсовой работы и будет содержать в себе критерии зачета).
