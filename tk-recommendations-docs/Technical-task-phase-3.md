# Техническое задание 3 этапа

## Рекомендации через телеграм-бота

Для рекламы создадим телеграм-бота, который будет выдавать рекомендации пользователям по имени.

Сейчас нужен работающий Proof of Concept для дизайнеров и аналитиков.

Добавьте в ваш сервис бота, который работает по следующему протоколу:

При первом обращении бот приветствует пользователя и печатает справку.
Единственная команда — /recommend username.
Команда возвращает рекомендации в форме:

```Text
/recommend <user.name>
Здравствуйте, <Имя и фамилия пользователя из БД>!
 
Новые продукты для вас:
 - список продуктов с рекомендациями,
 - удобно отформатированный.
```

Если пользователь не найден или найдено несколько пользователей, бот выдает сообщение «Пользователь не найден».
Правила выдачи рекомендаций и данные остаются без изменений.

## Статистика срабатывания правил рекомендаций

Нам важно знать, насколько часто срабатывают динамические правила рекомендаций для наших пользователей, поэтому нам необходимо будет вести статистику срабатываний правил.

Логика следующая: когда динамическое правило выполняется для пользователя, это значит, что мы выдали рекомендацию из правила этому пользователю, то есть нам нужно увеличить счетчик срабатываний на единицу.

При удалении динамического правила его счетчик срабатываний тоже удаляется.

Для реализации этого требования вам может понадобиться новая сущность.

У нас должна быть возможность получить статистику срабатываний по всем правилам с помощью REST-запроса, описанного в секции API.

Если по правилу еще не было ни одного срабатывания, то правило всё равно должно присутствовать в списке со значением 0.

```Text
API request: GET /rule/stats
Response
200 OK
```

```Json
{
   "stats":[
      {
         "rule_id":"id правила",
         "count":"< число срабатываний этого правила>"
      },
      {
         "rule_id": "id правила",
         "count": "число срабатываний этого правила"
      }
   ]
}
```

## Сброс кеша рекомендаций

Технологическая задача: разработать метод контроллера для сброса кеша.

Команда просит поддерживать следующий запрос:

При POST-запросе на

```Text
/management/clear-caches
```

очищаются все закешированные результаты. Это означает обновление базы данных.

Этот POST-запрос — без тела, ничего не принимается и не передается в @RequestBody. POST используется, чтобы показать, что произойдут изменения на сервере.

## Подготовка к продакшену

Каждый сервис должен поддерживать запрос

```Text
/management/info
```

который возвращает информацию в формате:

```Json
{
   "name": "<название сервиса>",
   "version": "<версия сервиса из файла pom.xml>",
}
```

Эти данные нужны для управления сервисом и отображения его в общем списке сервисов банка.

Чтобы извлечь данные из pom.xml, используйте эту статью:

[Generate build info.](https://docs.spring.io/spring-boot/how-to/build.html#howto.build.generate-info)

```Xml
<build>
  <plugins>
    <plugin>
      <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-maven-plugin</artifactId>
        <version>3.4.4</version>
        <executions>
          <execution>
            <goals>
              <goal>build-info</goal>
            </goals>
          </execution>
        </executions>
    </plugin>
  </plugins>
</build>
```

Для запуска Spring Boot Plugin выполните команду mvnw package. Это полностью соберет проект в JAR-файл. Тогда бин BuildInfo будет доступен вашему приложению.

## Критерии выполнения ТЗ

- система корректно взаимодействует с Телеграмом, и бот может выдавать рекомендации;
- система ведет статистику срабатывания динамических правил и позволяет получить ее через запрос /rule/stats;
- кеш всех запросов в системе можно сбросить, отправив POST-запрос по пути /management/clear-caches;
- можно получить название и версию системы с помощью запроса /management/info.
